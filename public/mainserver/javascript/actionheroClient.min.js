!function(a){var b=function(a){var b=this;b.callbacks={},b.id=null,b.events={},b.state="disconnected",b.options=b.defaults();for(var c in a)b.options[c]=a[c];if(a&&null!=a.faye)b.faye=a.faye;else if(null!=window.Faye)b.faye=window.Faye;else try{b.faye=Faye}catch(d){b.faye=null}};b.prototype.defaults=function(){var a;return"undefined"!=typeof window&&(a=window.location.origin),{host:a,fayePath:"/faye",apiPath:"/api",setupChannel:"/client/websocket/_incoming/"+this.randomString(),channelPrefix:"/client/websocket/connection/",connectionDelay:200,timeout:6e4,retry:10}},b.prototype.connect=function(a){var b=this;b.client=new b.faye.Client(b.options.host+b.options.fayePath,{retry:b.options.retry,timeout:b.options.timeout}),b.setupSubscription=b.client.subscribe(b.options.setupChannel,function(c){b.id=c.id,b.channel=b.options.channelPrefix+b.id,b.setupSubscription.cancel(),delete b.setupSubscription,b.subscription=b.client.subscribe(b.channel,function(a){b.handleMessage(a)}),setTimeout(function(){b.detailsView(function(c){null!=b.room&&b.send({event:"roomChange",room:b.room}),a(null,c)})},b.options.connectionDelay)}),b.client.on("transport:down",function(){b.state="reconnecting",b.emit("disconnected")}),b.client.on("transport:up",function(){var a=b.state;b.state="connected",b.messageCount=0,b.emit("connected"),"reconnecting"===a&&b.detailsView(function(){null!=b.room&&b.send({event:"roomChange",room:b.room})})})},b.prototype.send=function(a,b){var c=this;"connected"===c.state?(c.messageCount++,"function"==typeof b&&(c.callbacks[c.messageCount]=b),c.client.publish(c.channel,a)):"function"==typeof b&&b({error:"not connected",state:c.state})},b.prototype.handleMessage=function(a){var b=this;b.emit("message",a),"response"===a.context?("function"==typeof b.callbacks[a.messageCount]&&b.callbacks[a.messageCount](a),delete b.callbacks[a.messageCount]):"user"===a.context?b.emit("say",a):"alert"===a.context?b.emit("alert",a):null!=a.welcome&&"api"==a.context?(b.welcomeMessage=a.welcome,b.emit("welcome",a)):"api"===a.context&&b.emit("api",a)},b.prototype.action=function(a,b,c){null==c&&"function"==typeof b&&(c=b,b=null),null==b&&(b={}),b.action=a,"connected"!==this.state?this.actionWeb(b,c):this.actionWebSocket(b,c)},b.prototype.actionWeb=function(a,b){var c=setTimeout(function(){b("timeout")},this.options.timeout),d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState)if(clearTimeout(c),200==d.status){var a=JSON.parse(d.responseText);b(null,a)}else b(d.statusText,d.responseText)};var e="?";for(var f in a)e+=f+"="+a[f]+"&";var g="GET";null!=a.httpMethod&&(g=a.httpMethod);var h=this.options.host+this.options.apiPath+e;d.open(g,h,!0),d.send()},b.prototype.actionWebSocket=function(a,b){this.send({event:"action",params:a},b)},b.prototype.say=function(a,b){this.send({event:"say",message:a},b)},b.prototype.file=function(a,b){this.send({event:"file",file:a},b)},b.prototype.detailsView=function(a){this.send({event:"detailsView"},a)},b.prototype.roomView=function(a){this.send({event:"roomView"},a)},b.prototype.roomChange=function(a,b){this.room=a,this.send({event:"roomChange",room:a},b)},b.prototype.roomLeave=function(a){this.send({event:"roomLeave"},a)},b.prototype.listenToRoom=function(a,b){this.send({event:"listenToRoom",room:a},b)},b.prototype.silenceRoom=function(a,b){this.send({event:"silenceRoom",room:a},b)},b.prototype.documentation=function(a){this.send({event:"documentation"},a)},b.prototype.disconnect=function(){this.state="disconnected",this.client.disconnect()},b.prototype.on=function(a,b){var c=this;null==c.events[a]&&(c.events[a]={});var d=c.randomString();return c.events[a][d]=b,d},b.prototype.emit=function(a,b){var c=this;if(null!=c.events[a])for(var d in c.events[a])c.events[a][d](b)},b.prototype.removeListener=function(a,b){var c=this;delete c.events[a][b]},b.prototype.removeAllListeners=function(a){var b=this;delete b.events[a]},b.prototype.randomString=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;32>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a+="-"+(new Date).getTime()},a.actionheroClient=b}("undefined"==typeof exports?window:exports);